---
title: "Problem Section 7"
date:  "Elements of Significance Testing"
graphics: yes
output: pdf_document
header-includes:
    - \usepackage{amsmath, amssymb}
    - \usepackage{framed}\definecolor{shadecolor}{rgb}{0.949,0.949,0.949}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

\begin{shaded}

\textbf{Learning Outcomes}

The problems are designed to build conceptual understanding and problem-solving skills. The emphasis is on learning to find, evaluate and build confidence. The specific tasks include: 

   - Calculate one and two-sided P-values 
   
   - Find the Type I and Type II errors for a given decision rule
   
   - Find an empirical P-value
   
   - Back up and support work with relevant explanations



\end{shaded}


* * *

### Instructions

- Please work in groups of three to answer the problems below. 

- Each member of the group must write up their work on a separate sheet of paper. Be sure to clearly write your full name on the top as it appears in the gradebook.


### Exercises 


1. A children's game uses a six sided die with a picture of a ghost named Hugo on one side and numbers on the other sides. If the die is fair, the ghost should be rolled 1/6 of the time. You test the die by rolling it $n=10$ times and and the ghost is rolled $x=3$ times.  Calculate the P-value for an exact binomial test of the hypothesis
$$H_0: \pi = \frac{1}{6} \ \ \ H_1: \pi \neq \frac{1}{6}$$

    Since we are considering a two-sided alternative hypothesis, we will conduct a 2 tailed test.  First we can examine the null binomial PMF:

    ```{r}
    binom_tibble <- tibble(
      x = seq(0,10),
      binom_pmf = dbinom(x,10,1/6)
    )

    binom_tibble

    #plot PMF

    ggplot(data=binom_tibble, aes(x=x,
                              y=binom_pmf))+
      geom_col(width = 1)+
      geom_vline(xintercept=3,col='red')+
      scale_x_continuous(breaks = 0:10)+
      labs(y='probability')
    ```



    Thus for our 2-sided P-value we would consider the probability of observing data as extreme as ours, or more. We see in the above PMF, that the values that are more extreme (have lower probability) than x=3, are all values greater than 3. 

    ```{r}
    1 - pbinom(q = 2, size = 10, prob = 1/6)
    ```

    Thus when the null is true, there is a 22% chance of observing x=3, or more extreme data. This is a relatively high P-value so in general we would not consider it enough information to reject the null hypothesis. 

    Note: you can also automate the two-sided P-value calculation as shown below.

    ```{r}
     probs <- dbinom(0:10, size = 10, prob = 1/6)

    sum(probs[probs <= dbinom(x = 3, size = 10, prob = 1/6)] )

    ```

2. As input for a new inflation model, economists
predicted that the average cost of a hypothetical "food
basket" in western WA in July would be \$145.75. The
standard deviation ($\sigma_0$) of basket prices was assumed to be
$9.50, a figure that has held fairly constant over the years.
To check their prediction, a sample of twenty-five baskets
representing different parts of the region were checked in
late July, and the average cost was \$149.75. 

a. Let $\mu_0$ denote the true mean price of the food basket in July in Western WA. Write the null and alternative hypothesis.

    In this setting we would want to see if the observed mean from the 25 basket sample, \$149.75, is large enough to reject the hypothesized mean of \$145.75. Naturally we would form our null and alternative as follows:
    $$H_0: \mu_0 = 145.75 \ \ H_1: \mu_0 \neq 145.75 $$


b. Suppose the test will be based on $\bar{X}$ the sample mean. What is its sampling distribution?  (You may assume the CLT applies)

    If we assume that the CLT will apply that means that  we will have that:
    $$\bar{X} \sim N(\mu = \mu_0, \sigma = \frac{9.5}{\sqrt{25}} = 1.9)$$


c. Calculate the P-value associated with $\bar{x} = \$149.75$. 

    Since this is a two-sided alternative, the P-value is 
$$2 \min\{ P_{\mu_0=145.75}(\bar{X} \leq 149.75), P_{\mu_0=145.75}(\bar{X} \geq 149.75) \}.$$

    Since 149.75 is to the right of 145.75 - the mean of the normal distribution when the null hypothesis is true, it is clear that the $\mbox{P-value} = 2 \times P_{\mu_0=145.75}(\bar{X} \geq 149.75)$ as this will be the minimum.

    ```{r}
    2*pnorm(q = 149.75, mean = 145.75, sd = 9.5/sqrt(25), lower.tail=F)
    ```

    Thus when the null is true we see data this unusual or more about 3% of the time. 



3. An experimenter takes a sample of size 4 - $X_1, X_2, X_3,X_4$ - from
the Poisson probability model, 
$$f(x) = e^{-\lambda_0} \frac{\lambda_0^{x}}{x!} \ \ \ x=0,1,2, \dots$$
 and wishes to test
$H0: \lambda_0 = 6$ versus $H_1: \lambda_0 < 6$. The test will be based on the statistic $S = X_1+X_2+X_3+X_4$. 

a. Find the P-value associated with observing $s_{obs} = 15$. 
   
   Since small values of $S$ lie in the direction predicted by $H_1$ (why?), the P-value is 
    $$\mbox{P-value} = P_{\lambda_0 = 6}(S \leq s_{obs})$$
    with $S \sim Pois(4 \lambda_0)$.
    
    This is calculated below.
    
    ```{r}
    ppois(q = 15, lambda = 4*6)
    
    ```
    
b. Suppose we decide to conduct the test at level $\alpha = 0.1$. What values of $s_{obs}$ will you reject $H_0$ for?

    We will reject for any $s_{obs}$ that satisfies that $P_{\lambda_0 = 6}(S \leq s_{obs}) \leq 0.1$.  Since the Poisson PMF is monotonically decreasing, for large values, we can create the table of Poisson probabilities to find the smallest $s_{obs}$ for which we will reject $H_0$. A more succinct alternative to target the search is to find the 10th percentile of the distribution first.
    
    ```{r}
    
    qpois(p = 0.1, lambda = 4*6)  #18 has at least 10% probability below it
    
    ppois(18, lambda = 24)        #let's see how much exactly 
    
    ppois(17, lambda = 24)
    ```
    
    Therefore we would reject $H_0$ for any $s_{obs} \leq 17$ since these values would give a P-value smaller than 0.1.

c. Find the Type I error rate for your test in part b.

    
   A Type 1 error occurs when we mistakenly reject $H_0$. That is, we reject $H_0$ even though $H_0$ is true. The probability of a Type I error in this example is $P_{\lambda_0 = 6}(S \leq 17)$.
    
    ```{r}
    ppois(17, lambda = 4*6)
    
    ```
    
d. Calculate the Type II error rate for your test in part b. when $\lambda_0 = 4$. 
   
   A Type II error occurs when we mistakenly fail to reject $H_0$. That is, we do not reject $H_0$ even though $H_1$ is true. The probability of a Type II error is $P_{\lambda_0 = 4}(S > 17)$.
    
    ```{r}
    ppois(17, lambda = 4*4, lower.tail = FALSE)
    
    ```


4. An urn contains ten marbles: an unknown number of them are white, the rest red. We wish to test:
$$H_0: \mbox{exactly half are white}$$
versus 
$$H_1: \mbox{more than half are white}$$
We will draw randomly, without replacement, three marbles and reject $H_0$ if two or more are white.

a. Find the Type I error rate of this test. (Hint: the number of white marbles among the three drawn is called a hypergeometric random variable)

Let X be the number of white marbles drawn from a draw of k = 3 marbles with replacement. We thus have that under the null, the sampling distribution of X is:

$$P(X = x) = \frac{ \binom{5}{x} \binom{5}{3-x}}{\binom{10}{3}} \quad x=0,1,2,3$$

In fact we can say $X \sim Hypergeom(m = 5,n = 5,k = 3)$.

We reject if 2 or more of the draws are white. We see that this has a probability of:

```{r}
#P(X>=2) = 1 - P(X<=1)

1 - choose(5,0)*choose(5,3)/choose(10,3) - choose(5,1)*choose(5,2)/choose(10,3)

1 - phyper(1,m=5,n=5,k=3)
```

Thus we have a type I error rate of of 0.5.


b. Find the Type II error rate in two situations.
   
      - 60\% of the marbles in the urn are white
      
      - 70\% of the marbles in the urn are white.
      
If 60\% are white then the PMF of $X$ is

$$P(X = x) = \frac{\binom{6}{x} \binom{4}{3-x}}{\binom{10}{3}} \quad x=0,1,2,3$$

The Type II error is the probability of mistakenly failing to reject $H_0$. In other words we want to find $P(X < 2)$.

```{r}
#P(X < 2)$
choose(6,0)*choose(4,3)/choose(10,3) + choose(6,1)*choose(4,2)/choose(10,3)

#P(X<2) = P(X<=1)
phyper(1,m=6,n=4,k = 3)
```
      
Similar to above, if 70% of the marbles are white, under this alternative:

$$P(X = x) = \frac{\binom{7}{x} \binom{3}{3-x}}{\binom{10}{3}} \quad x=0,1,2,3$$


Thus we have a type II error rate of:

```{r}
#P(X < 2)$
choose(7,0)*choose(3,3)/choose(10,3) + choose(7,1)*choose(3,2)/choose(10,3)


phyper(1,m=7,n=3,k=3)
```

